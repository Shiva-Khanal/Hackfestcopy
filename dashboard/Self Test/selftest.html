
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>TestPrep</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link rel="stylesheet" href="selftest.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>

  <!-- Top bar -->
  <div class="top-bar" id="topBar">
    <div class="topbar-left flex items-center gap-3">
      <i class="fa-solid fa-file-pen text-2xl text-[#3d4ea1ce]"></i>
      <h1 class="text-3xl font-bold">Create Your Own Test</h1>
    </div>
  </div>

  <div class="max-w-4xl mx-auto py-5" id="createSection">
    
    <!-- Test Name -->
    <div class="form-section">
      <label class="block mb-3">
        <span class="font-medium">Test Name</span>
        <input id="testName" type="text" placeholder="Enter test name" class="form-input mt-1 block border border-gray-300 rounded-lg p-2">
      </label>
    </div>

    <!-- Subjects -->
    <div class="form-section">
      <span class="font-medium">Select Subjects</span>
      <div class="flex flex-wrap gap-2 my-2" id="subjectContainer">
        <input type="radio" name="subject-btn" value="Math" class="subject-btn px-3 py-1 rounded bg-gray-200">Math</input>
        <input type="radio" name="subject-btn" value="Physics" class="subject-btn px-3 py-1 rounded bg-gray-200">Physics</input>
        <input type="radio" name="subject-btn" value="Chemistry" class="subject-btn px-3 py-1 rounded bg-gray-200">Chemistry</input>
        <input type="radio" name="subject-btn" value="Computer Science" class="subject-btn px-3 py-1 rounded bg-gray-200">Computer Science</input>
        <input type="radio" name="subject-btn" value="Nepali" class="subject-btn px-3 py-1 rounded bg-gray-200">Nepali</input>
        <input type="radio" name="subject-btn" value="English" class="subject-btn px-3 py-1 rounded bg-gray-200">English</input>
      </div>
    </div>

    <!-- Custom Subject -->
    <div class="form-section">
      <label class="block mb-3">
        <span class="font-medium">Custom Subject</span>
        <input id="customSubject" type="text" placeholder="Enter custom subject name" class="form-input mt-1 block border border-gray-300 rounded-lg p-2">
      </label>
    </div>

    <!-- Number of Questions -->
    <div class="form-section">
      <label class="block mb-3">
        <span class="font-medium">Number of Questions</span>
        <input id="numQuestions" type="number" min="1" placeholder="e.g. 3" class="form-input mt-1 block border border-gray-300 rounded-lg p-2">
      </label>
    </div>

    <!-- Questions Area -->
    <div id="questionsArea" class="form-section"></div>

    <!-- Add Question Button -->
    <button id="generateQuestions" class="shine-btn px-4 py-2 rounded font-bold mt-2">Generate Question Fields</button>

    <!-- Save Test -->
    <button id="saveTest" class="shine-btn px-4 py-2 rounded font-bold mt-4">Save Test</button>

    <hr class="my-6">

    <!-- Take Test Section -->
    <div class="form-section">
      <h2 class="text-2xl font-bold mb-4">Take a Saved Test</h2>
      <select id="testSelect" class="form-select border-gray-300 rounded-lg p-2 mb-4"></select>
    </div>
  </div>

  <!-- Test Display Section -->
  <div id="takeTestSection" class="max-w-4xl mx-auto py-5 hidden">
    <div id="takeTestArea"></div>
  </div>

<script>
  let selectedSubjects = [];

  document.querySelectorAll('.subject-btn').forEach(btn => {
    btn.addEventListener('change', () => {
      if (btn.checked) selectedSubjects.push(btn.value);
    });
  });

  document.getElementById('generateQuestions').addEventListener('click', () => {
    const num = parseInt(document.getElementById('numQuestions').value);
    const qArea = document.getElementById('questionsArea');
    qArea.innerHTML = '';
    if (!num || num < 1) return alert("Enter valid number of questions");
    for (let i = 1; i <= num; i++) {
      qArea.innerHTML += `
        <div class="mb-3">
          <label class="block font-medium">Question ${i}</label>
          <textarea class="q-text form-input block w-full border rounded-lg p-2 mb-1" placeholder="Enter question"></textarea>
          <input class="q-answer form-input block w-full border rounded-lg p-2" placeholder="Enter correct answer">
        </div>
      `;
    }
  });

  document.getElementById('saveTest').addEventListener('click', () => {
    const testName = document.getElementById('testName').value.trim();
    const customSubject = document.getElementById('customSubject').value.trim();
    const num = parseInt(document.getElementById('numQuestions').value);

    if (!testName) return alert("Test name required");
    let subjects = [...selectedSubjects];
    if (customSubject) subjects.push(customSubject);

    let questions = [];
    document.querySelectorAll('.q-text').forEach((q, i) => {
      const ans = document.querySelectorAll('.q-answer')[i].value.trim();
      questions.push({ question: q.value.trim(), answer: ans });
    });

    if (questions.length !== num || questions.some(q => !q.question || !q.answer))
      return alert("Fill all questions and answers");

    let tests = JSON.parse(localStorage.getItem('tests') || '[]');
    tests.push({ name: testName, subjects, questions });
    localStorage.setItem('tests', JSON.stringify(tests));

    alert("Test saved!");
    loadTestSelect();
  });

  function loadTestSelect() {
    const select = document.getElementById('testSelect');
    const tests = JSON.parse(localStorage.getItem('tests') || '[]');
    select.innerHTML = `<option value="">Select a test</option>`;
    tests.forEach((t, i) => {
      select.innerHTML += `<option value="${i}">${t.name}</option>`;
    });
  }

  document.getElementById('testSelect').addEventListener('change', function() {
    const index = this.value;
    const tests = JSON.parse(localStorage.getItem('tests') || '[]');
    const takeArea = document.getElementById('takeTestArea');
    const takeSection = document.getElementById('takeTestSection');
    takeArea.innerHTML = '';

    if (index === "") {
      takeSection.classList.add('hidden');
      return;
    }

    document.getElementById('createSection').innerHTML = "";

    const test = tests[index];
    test.questions.forEach((q, i) => {
      takeArea.innerHTML += `
        <div class="mb-3">
          <p class="font-medium">Q${i+1}: ${q.question}</p>
          <input class="user-answer form-input border rounded-lg p-2 mb-1" data-ans="${q.answer}" style="color:black;">
        </div>
      `;
    });
    takeArea.innerHTML += `<button id="submitTest" class="shine-btn px-4 py-2 rounded font-bold">Submit Answers</button>`;
    
    takeSection.classList.remove('hidden');
    takeSection.scrollIntoView({ behavior: 'smooth' });

    document.getElementById('submitTest').addEventListener('click', () => {
      document.querySelectorAll('.user-answer').forEach(input => {
        const correct = input.dataset.ans.trim().toLowerCase();
        const user = input.value.trim().toLowerCase();

        input.style.color = "black";

        let feedback = input.parentElement.querySelector(".feedback");
        if (feedback) feedback.remove();

        feedback = document.createElement("p");
        feedback.classList.add("feedback", "mt-1", "text-sm", "font-semibold");

        if (user === correct) {
          input.classList.add('border-green-500');
          input.classList.remove('border-red-500');
          feedback.textContent = "✅ Correct!";
          feedback.style.color = "green";
        } else {
          input.classList.add('border-red-500');
          input.classList.remove('border-green-500');
          feedback.textContent = `❌ Wrong! Correct Answer: ${input.dataset.ans}`;
          feedback.style.color = "red";
        }

        input.parentElement.appendChild(feedback);
      });
    });
  });

  loadTestSelect();

  // Top bar animation
  window.addEventListener('load', () => {
    document.getElementById('topBar').classList.add('show');
  });
</script>
</body>
</html>
